<!-- Dev branch -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Patient Intake Form</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      background-color: #4682B4;
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 20px;
    }
    .form-container {
      background: white;
      max-width: 1000px;
      margin: 0 auto;
      padding: 40px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    h1 {
      color: #0033A0;
      font-size: 32px;
      text-align: center;
      margin-bottom: 10px;
    }
    h2 {
      color: #0033A0;
      font-size: 24px;
      margin-top: 20px;
    }
    p.subtitle {
      text-align: center;
      font-style: italic;
      color: #333;
      font-size: 18px;
      margin-bottom: 20px;
    }
    hr {
      border: 1px solid #0033A0;
      margin: 20px 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    td {
      padding: 10px;
      vertical-align: top;
    }
    input[type="text"], input[type="email"], input[type="tel"], input[type="date"] {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
      margin-top: 5px;
    }
    input[type="checkbox"] {
      margin-right: 10px;
      transform: scale(1.5);
    }
    input[type="checkbox"] + label {
      color: #1E90FF;
      font-size: 16px;
    }
    .policy-box {
      background: #f8f8f8;
      border: 1px solid #0033A0;
      border-radius: 5px;
      padding: 20px;
      margin: 20px 0;
      font-size: 16px;
      line-height: 1.5;
    }
    button {
      background-color: #9933FF;
      color: white;
      padding: 15px 30px;
      border: none;
      border-radius: 5px;
      font-size: 18px;
      cursor: pointer;
      display: block;
      margin: 20px auto;
    }
    button:hover {
      background-color: #7a29cc;
    }
    @media (max-width: 600px) {
      .form-container {
        padding: 20px;
      }
      h1 { font-size: 24px; }
      h2 { font-size: 20px; }
      input[type="text"], input[type="email"], input[type="tel"], input[type="date"] {
        font-size: 14px;
        padding: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="form-container">
    <h1>WestCoast Digital Denture and Implant Center</h1>
    <p class="subtitle">Chris R. Chapman, L.D. & Melanie E. Chapman, L.D.</p>
    <h2 style="text-align: center;">Patient Intake Form</h2>
    <hr>
    <form id="intakeForm">
      <h2>Personal Information</h2>
      <table>
        <tr><td>Full Name:</td><td><input type="text" name="name" placeholder="Enter your full name" required></td></tr>
        <tr><td>Birthdate:</td><td><input type="date" name="birthdate" placeholder="Select your birthdate"></td></tr>
        <tr><td>Address:</td><td><input type="text" name="address" placeholder="Enter your street address"></td></tr>
        <tr><td>City:</td><td><input type="text" name="city" placeholder="Enter your city"></td></tr>
        <tr><td>State:</td><td><input type="text" name="state" placeholder="Enter your state"></td></tr>
        <tr><td>Zip:</td><td><input type="text" name="zip" placeholder="Enter your zip code"></td></tr>
        <tr><td>Phone:</td><td><input type="tel" name="phone" placeholder="Enter your phone number"></td></tr>
        <tr><td>E-Mail:</td><td><input type="email" name="email" placeholder="Enter your email address"></td></tr>
        <tr><td>Occupation/Employer:</td><td><input type="text" name="occupation" placeholder="Enter your occupation or employer"></td></tr>
        <tr><td>Emergency Contact Name:</td><td><input type="text" name="emergencyContactName" placeholder="Enter emergency contact name"></td></tr>
        <tr><td>Emergency Contact Phone:</td><td><input type="tel" name="emergencyContactPhone" placeholder="Enter emergency contact phone"></td></tr>
        <tr><td>Physician Name and Contact:</td><td><input type="text" name="physician" placeholder="Enter physician name and phone"></td></tr>
      </table>
      <hr>
      <h2>Insurance Information</h2>
      <table>
        <tr><td>Insurance Company:</td><td><input type="text" name="insuranceCompany" placeholder="Enter insurance company name"></td></tr>
        <tr><td>Address:</td><td><input type="text" name="insuranceAddress" placeholder="Enter insurance company address"></td></tr>
        <tr><td>City:</td><td><input type="text" name="insuranceCity" placeholder="Enter city"></td></tr>
        <tr><td>State:</td><td><input type="text" name="insuranceState" placeholder="Enter state"></td></tr>
        <tr><td>Zip:</td><td><input type="text" name="insuranceZip" placeholder="Enter zip code"></td></tr>
      </table>
      <hr>
      <h2>Dental History</h2>
      <table>
        <tr><td>Age of Current Denture:</td><td><input type="text" name="dentureAge" placeholder="Enter age of current denture"></td></tr>
        <tr><td>Last Dentures Received:</td><td><input type="text" name="lastDentures" placeholder="Enter where you received your last dentures"></td></tr>
        <tr><td>Referral Source:</td><td><input type="text" name="referral" placeholder="Enter how you heard about us"></td></tr>
      </table>
      <hr>
      <h2>Medical History</h2>
      <p>Please check all that apply and list medications below:</p>
      <table>
        <tr><td><input type="checkbox" name="doctorCare" value="Yes"><label>Under doctor care?</label></td></tr>
        <tr><td><input type="checkbox" name="teethAppearance" value="Yes"><label>Dissatisfied with teeth appearance?</label></td></tr>
        <tr><td><input type="checkbox" name="chewingDifficulty" value="Yes"><label>Difficulty chewing?</label></td></tr>
        <tr><td><input type="checkbox" name="slowHealing" value="Yes"><label>Slow-healing sores?</label></td></tr>
        <tr><td><input type="checkbox" name="mouthOpening" value="Yes"><label>Difficulty opening mouth?</label></td></tr>
        <tr><td><input type="checkbox" name="dentalAdhesives" value="Yes"><label>Use dental adhesives?</label></td></tr>
        <tr><td><input type="checkbox" name="gagging" value="Yes"><label>Difficulty with gagging?</label></td></tr>
        <tr><td><input type="checkbox" name="hepatitis" value="Yes"><label>Hepatitis</label></td></tr>
        <tr><td><input type="checkbox" name="rheumaticFever" value="Yes"><label>Rheumatic Fever</label></td></tr>
        <tr><td><input type="checkbox" name="highBloodPressure" value="Yes"><label>High Blood Pressure</label></td></tr>
        <tr><td><input type="checkbox" name="lowBloodPressure" value="Yes"><label>Low Blood Pressure</label></td></tr>
        <tr><td><input type="checkbox" name="cancer" value="Yes"><label>Cancer or Tumor</label></td></tr>
        <tr><td><input type="checkbox" name="fainting" value="Yes"><label>Fainting Spells</label></td></tr>
        <tr><td><input type="checkbox" name="epilepsy" value="Yes"><label>Epilepsy</label></td></tr>
        <tr><td><input type="checkbox" name="bleeding" value="Yes"><label>Excessive Bleeding</label></td></tr>
        <tr><td><input type="checkbox" name="headaches" value="Yes"><label>Frequent Headaches</label></td></tr>
        <tr><td><input type="checkbox" name="diabetes" value="Yes"><label>Diabetes</label></td></tr>
        <tr><td><input type="checkbox" name="heartDisease" value="Yes"><label>Heart Disease</label></td></tr>
        <tr><td><input type="checkbox" name="venerealDisease" value="Yes"><label>Venereal Disease</label></td></tr>
        <tr><td><input type="checkbox" name="allergies" value="Yes"><label>Allergies</label></td></tr>
        <tr><td><input type="checkbox" name="coldSores" value="Yes"><label>Cold Sores</label></td></tr>
        <tr><td><input type="checkbox" name="stroke" value="Yes"><label>Stroke</label></td></tr>
      </table>
      <p>Medications:</p>
      <input type="text" name="medications" placeholder="List all medications" style="width: 100%;">
      <hr>
      <h2>Clinic Policies</h2>
      <div class="policy-box">
        <h3>Financial Arrangements</h3>
        <p>It is our desire to hold our cost to you, our patient, as low as possible. In order to do this, we must have a constant cash flow in our business. For your convenience, we accept cash, checks and major credit cards. For major services, including fabrication of dentures and partial dentures, our office requires payment of ONE-HALF down at the time the impressions are taken and the balance to be paid prior to delivery of the dentures. All other services require payment at the time services are rendered. If this presents a problem to you, please let us know and we will be happy to reschedule you for a more convenient time.</p>
      </div>
      <p><input type="checkbox" name="financialAgree" value="Yes"><label>I agree to the financial arrangements above.</label></p>
      <div class="policy-box">
        <h3>Insurance Authorization & Billing Information</h3>
        <p>We bill insurance as a courtesy to our patients. Patients who carry dental insurance understand that all services will be charged directly to the patient prior to the completion of treatment. Insurance is billed as a reimbursement to the patient at the end of the treatment period. It is understood that the patient/responsible party agrees to be fully responsible for the payment of services. Please note, all claims are submitted with no guarantee of payment.</p>
        <p>I have read and accept the terms and conditions outlined above by The Denture Specialist as it relates to payment for services. I agree to be fully responsible for the payment of services provided to me by The Denture Specialist office. If applicable, I give The Denture Specialist permission to submit dental claims for services on my behalf. To the extent permitted by law, I consent to your use and disclosure of my protected health information to carry out payment activities in connection with any claims.</p>
      </div>
      <p><input type="checkbox" name="insuranceAgree" value="Yes"><label>I authorize insurance claims submission and accept billing terms.</label></p>
      <div class="policy-box">
        <h3>Patient Rights</h3>
        <p>You have the right to look at or get copies of your health information with limited exceptions. This request may be sent in writing to one of the addresses listed above via certified mail. You will be charged a reasonable fee for copies, postage and staff time. You may have the right to place additional restrictions on usage or disclosure of your health information. We are not required by law to agree to these restrictions. To the best of our ability, we will abide by restrictions except in the event of an emergency in our professional opinion. You may request alternate means or locations of which to discuss your information. This must be presented in writing with a satisfactory explanation and detailed format of how payments will be handled under the alternate means or location you request. You have the right to amend your health information in writing and it must explain why the amendment is to take place. We may deny your request under certain circumstances.</p>
      </div>
      <p><input type="checkbox" name="patientRightsAgree" value="Yes"><label>I acknowledge my patient rights.</label></p>
      <div class="policy-box">
        <h3>Notice of Privacy Practices</h3>
        <p>We respect our obligation to keep your health information private. We are obligated by law to give you notice of our privacy practices. This notice describes how we protect your health information and what rights you have regarding it.</p>
        <p>We may use and disclose your health information to a denturist, dentist or other healthcare provider for treatment purposes. We may use and disclose your health information to bill and collect payment for services we provide to you. Within our professional judgment and unless you object, we will share relevant health and dental information with family and friends assisting in your care.</p>
        <p>We will not use your information for marketing without your written authorization. We will disclose your health information when required by federal, state or local law authorities or legal processes such as, but not limited to subpoena, court order, warrants or summons. We may disclose your information to appropriate authorities if we reasonably suspect you are a victim of a possible crime so as to avert serious threat to your safety and the safety of those around you. We may use your information to provide appointment reminders such as, but not limited to post cards, voicemail or letters.</p>
        <p>We are required to provide you with a copy of our Notice of Privacy Practices which states how we may use and/or disclose your health information. If you are filling out online paperwork, you will receive a copy at your next appointment or by email.</p>
      </div>
      <p><input type="checkbox" name="privacyNoticeAgree" value="Yes"><label>I acknowledge receipt of the Notice of Privacy Practices.</label></p>
      <div class="policy-box">
        <h3>Cancellation and Missed Appointment Policy</h3>
        <p>At WestCoast Digital Denture and Implant Center we believe in denture care that is founded upon excellence and quality. We seek to accomplish this, in part, by being on time and prepared for every patient appointment. We feel this will cause minimal disruption to your daily schedule and will provide as much efficiency as possible in completing your denture treatment.</p>
        <p>Office hours are by appointment only. This office provides private, personal denture care. Appointment time is reserved for you alone.</p>
        <p>When you make an appointment with us, please be sure that you will be able to keep it. We understand that emergencies and unforeseen treatment problems may arise, causing schedule changes. We always try our best to ensure these circumstances do not inconvenience other patients and we appreciate your understanding of those situations.</p>
        <p>As a courtesy, our office will call in an attempt to confirm your appointment the day before it is scheduled (we call on Friday for Monday appointments).</p>
        <p>If you cannot make an appointment as scheduled, please notify the office. Please be aware that if you arrive more than 15 minutes late to your scheduled appointment you may be asked to reschedule. There will be a charge of $75 for missed appointments or appointments that are not canceled with more than a 24 hour notice. Patients who break appointments may also be required to prepay for future treatment.</p>
        <p>If you have any questions about our appointment cancellation policy, please let us know!</p>
      </div>
      <p><input type="checkbox" name="cancellationAgree" value="Yes"><label>I acknowledge the cancellation and missed appointment policy.</label></p>
      <hr>
      <h2>Acknowledgement of Receipt</h2>
      <p>By signing below, I acknowledge that I have received and reviewed the Financial Arrangements, Insurance Authorization & Billing Information, and Notice of Privacy Practices.</p>
      <table>
        <tr><td>Signature:</td><td><input type="text" name="signature" placeholder="Enter your signature" required></td></tr>
        <tr><td>Date:</td><td><input type="date" name="signatureDate" placeholder="Select today’s date" required></td></tr>
      </table>
      <button type="submit">Submit Form</button>
    </form>
  </div>
  <script>
    const { jsPDF } = window.jspdf;
    document.getElementById('intakeForm').addEventListener('submit', async (event) => {
      event.preventDefault();
      const formData = new FormData(event.target);
      const data = Object.fromEntries(formData);
      data.timestamp = new Date().toISOString();
      try {
        const doc = new jsPDF();
        const pageWidth = doc.internal.pageSize.width;
        const pageHeight = doc.internal.pageSize.height;
        const formWidth = pageWidth * 0.95;
        const formX = (pageWidth - formWidth) / 2;
        const formPadding = 15;
        const lineHeight = 7;
        const marginBottom = 20;
        function addNewPage() {
          doc.addPage();
          doc.setFillColor(70, 130, 180);
          doc.rect(0, 0, pageWidth, pageHeight, 'F');
          doc.setFillColor(255, 255, 255);
          doc.setDrawColor(0, 51, 160);
          doc.rect(formX, 10, formWidth, pageHeight - 20, 'FD');
          return 20;
        }
        function checkPageOverflow(y, additionalHeight) {
          if (y + additionalHeight > pageHeight - marginBottom) {
            return addNewPage();
          }
          return y;
        }
        doc.setFillColor(70, 130, 180);
        doc.rect(0, 0, pageWidth, pageHeight, 'F');
        doc.setFillColor(255, 255, 255);
        doc.setDrawColor(0, 51, 160);
        doc.rect(formX, 10, formWidth, pageHeight - 20, 'FD');
        doc.setFontSize(20).setTextColor(0, 51, 160);
        doc.text('WestCoast Digital Denture and Implant Center', pageWidth / 2, 30, { align: 'center' });
        doc.setFontSize(16).text('Patient Intake Form', pageWidth / 2, 45, { align: 'center' });
        doc.setFontSize(10).setFont('times', 'italic').text('Chris R. Chapman, L.D. & Melanie E. Chapman, L.D.', pageWidth / 2, 55, { align: 'center' });
        doc.setLineWidth(0.5).setDrawColor(0, 51, 160);
        doc.line(formX, 60, formX + formWidth, 60);
        let y = 70;
        function addSection(title, fields, isPolicy = false) {
          y = checkPageOverflow(y, 20);
          doc.setFontSize(16).setFont('helvetica', 'bold').setTextColor(0, 51, 160);
          doc.text(title, formX + formPadding, y);
          y += 10;
          doc.setFontSize(10).setFont('helvetica', 'normal').setTextColor(0, 0, 0);
          if (isPolicy) {
            fields.forEach(([label, value, agreeField]) => {
              const titleHeight = 7;
              const lines = doc.splitTextToSize(value, formWidth - 2 * formPadding);
              const textHeight = lines.length * lineHeight;
              const signatureHeight = (data[agreeField] === 'Yes' && data.signature) ? lineHeight + 3 : 0;
              const totalHeight = titleHeight + textHeight + signatureHeight + 10;
              y = checkPageOverflow(y, totalHeight);
              doc.setFontSize(12).setFont('helvetica', 'bold');
              doc.text(label, formX + formPadding, y);
              y += 7;
              doc.setFontSize(10).setFont('helvetica', 'normal');
              lines.forEach(line => {
                doc.text(line, formX + formPadding, y);
                y += lineHeight;
              });
              if (data[agreeField] === 'Yes' && data.signature) {
                y += 3;
                doc.setFont('helvetica', 'bold');
                doc.text(`Signature: ${data.signature}`, formX + formPadding, y);
                y += lineHeight + 3;
              }
              y += 3;
            });
          } else {
            fields.forEach(([label, value]) => {
              if (value || isPolicy) {
                const text = `${label}: ${value || ''}`;
                const lines = doc.splitTextToSize(text, formWidth - 2 * formPadding);
                const textHeight = lines.length * lineHeight;
                y = checkPageOverflow(y, textHeight + 3);
                lines.forEach(line => {
                  doc.text(line, formX + formPadding, y);
                  y += lineHeight;
                });
                y += 3;
              }
            });
          }
          y = checkPageOverflow(y, 10);
          doc.line(formX, y, formX + formWidth, y);
          y += 10;
        }
        addSection('Personal Information', [
          ['Full Name', data.name],
          ['Birthdate', data.birthdate],
          ['Address', data.address],
          ['City', data.city],
          ['State', data.state],
          ['Zip', data.zip],
          ['Phone', data.phone],
          ['E-Mail', data.email],
          ['Occupation/Employer', data.occupation],
          ['Emergency Contact Name', data.emergencyContactName],
          ['Emergency Contact Phone', data.emergencyContactPhone],
          ['Physician Name and Contact', data.physician]
        ]);
        addSection('Insurance Information', [
          ['Insurance Company', data.insuranceCompany],
          ['Address', data.insuranceAddress],
          ['City', data.insuranceCity],
          ['State', data.insuranceState],
          ['Zip', data.insuranceZip]
        ]);
        addSection('Dental History', [
          ['Age of Current Denture', data.dentureAge],
          ['Last Dentures Received', data.lastDentures],
          ['Referral Source', data.referral]
        ]);
        addSection('Medical History', [
          ['Medications', data.medications],
          ['Under doctor care?', data.doctorCare || 'No'],
          ['Dissatisfied with teeth appearance?', data.teethAppearance || 'No'],
          ['Difficulty chewing?', data.chewingDifficulty || 'No'],
          ['Slow-healing sores?', data.slowHealing || 'No'],
          ['Difficulty opening mouth?', data.mouthOpening || 'No'],
          ['Use dental adhesives?', data.dentalAdhesives || 'No'],
          ['Difficulty with gagging?', data.gagging || 'No'],
          ['Hepatitis', data.hepatitis || 'No'],
          ['Rheumatic Fever', data.rheumaticFever || 'No'],
          ['High Blood Pressure', data.highBloodPressure || 'No'],
          ['Low Blood Pressure', data.lowBloodPressure || 'No'],
          ['Cancer or Tumor', data.cancer || 'No'],
          ['Fainting Spells', data.fainting || 'No'],
          ['Epilepsy', data.epilepsy || 'No'],
          ['Excessive Bleeding', data.bleeding || 'No'],
          ['Frequent Headaches', data.headaches || 'No'],
          ['Diabetes', data.diabetes || 'No'],
          ['Heart Disease', data.heartDisease || 'No'],
          ['Venereal Disease', data.venerealDisease || 'No'],
          ['Allergies', data.allergies || 'No'],
          ['Cold Sores', data.coldSores || 'No'],
          ['Stroke', data.stroke || 'No']
        ]);
        addSection('Clinic Policies', [
          ['Financial Arrangements', 'It is our desire to hold our cost to you, our patient, as low as possible. In order to do this, we must have a constant cash flow in our business. For your convenience, we accept cash, checks and major credit cards. For major services, including fabrication of dentures and partial dentures, our office requires payment of ONE-HALF down at the time the impressions are taken and the balance to be paid prior to delivery of the dentures. All other services require payment at the time services are rendered. If this presents a problem to you, please let us know and we will be happy to reschedule you for a more convenient time.', 'financialAgree'],
          ['Insurance Authorization & Billing Information', 'We bill insurance as a courtesy to our patients. Patients who carry dental insurance understand that all services will be charged directly to the patient prior to the completion of treatment. Insurance is billed as a reimbursement to the patient at the end of the treatment period. It is understood that the patient/responsible party agrees to be fully responsible for the payment of services. Please note, all claims are submitted with no guarantee of payment. I have read and accept the terms and conditions outlined above by The Denture Specialist as it relates to payment for services. I agree to be fully responsible for the payment of services provided to me by The Denture Specialist office. If applicable, I give The Denture Specialist permission to submit dental claims for services on my behalf. To the extent permitted by law, I consent to your use and disclosure of my protected health information to carry out payment activities in connection with any claims.', 'insuranceAgree'],
          ['Patient Rights', 'You have the right to look at or get copies of your health information with limited exceptions. This request may be sent in writing to one of the addresses listed above via certified mail. You will be charged a reasonable fee for copies, postage and staff time. You may have the right to place additional restrictions on usage or disclosure of your health information. We are not required by law to agree to these restrictions. To the best of our ability, we will abide by restrictions except in the event of an emergency in our professional opinion. You may request alternate means or locations of which to discuss your information. This must be presented in writing with a satisfactory explanation and detailed format of how payments will be handled under the alternate means or location you request. You have the right to amend your health information in writing and it must explain why the amendment is to take place. We may deny your request under certain circumstances.', 'patientRightsAgree'],
          ['Notice of Privacy Practices', 'We respect our obligation to keep your health information private. We are obligated by law to give you notice of our privacy practices. This notice describes how we protect your health information and what rights you have regarding it. We may use and disclose your health information to a denturist, dentist or other healthcare provider for treatment purposes. We may use and disclose your health information to bill and collect payment for services we provide to you. Within our professional judgment and unless you object, we will share relevant health and dental information with family and friends assisting in your care. We will not use your information for marketing without your written authorization. We will disclose your health information when required by federal, state or local law authorities or legal processes such as, but not limited to subpoena, court order, warrants or summons. We may disclose your information to appropriate authorities if we reasonably suspect you are a victim of a possible crime so as to avert serious threat to your safety and the safety of those around you. We may use your information to provide appointment reminders such as, but not limited to post cards, voicemail or letters. We are required to provide you with a copy of our Notice of Privacy Practices which states how we may use and/or disclose your health information. If you are filling out online paperwork, you will receive a copy at your next appointment or by email.', 'privacyNoticeAgree'],
          ['Cancellation and Missed Appointment Policy', 'At WestCoast Digital Denture and Implant Center we believe in denture care that is founded upon excellence and quality. We seek to accomplish this, in part, by being on time and prepared for every patient appointment. We feel this will cause minimal disruption to your daily schedule and will provide as much efficiency as possible in completing your denture treatment. Office hours are by appointment only. This office provides private, personal denture care. Appointment time is reserved for you alone. When you make an appointment with us, please be sure that you will be able to keep it. We understand that emergencies and unforeseen treatment problems may arise, causing schedule changes. We always try our best to ensure these circumstances do not inconvenience other patients and we appreciate your understanding of those situations. As a courtesy, our office will call in an attempt to confirm your appointment the day before it is scheduled (we call on Friday for Monday appointments). If you cannot make an appointment as scheduled, please notify the office. Please be aware that if you arrive more than 15 minutes late to your scheduled appointment you may be asked to reschedule. There will be a charge of $75 for missed appointments or appointments that are not canceled with more than a 24 hour notice. Patients who break appointments may also be required to prepay for future treatment. If you have any questions about our appointment cancellation policy, please let us know!', 'cancellationAgree']
        ], true);
        addSection('Acknowledgements', [
          ['Financial Arrangements Agreed', data.financialAgree || 'No'],
          ['Insurance Claims and Billing Authorized', data.insuranceAgree || 'No'],
          ['Patient Rights Acknowledged', data.patientRightsAgree || 'No'],
          ['Notice of Privacy Practices Received', data.privacyNoticeAgree || 'No'],
          ['Cancellation Policy Acknowledged', data.cancellationAgree || 'No']
        ]);
        addSection('Acknowledgement of Receipt', [
          ['Signature', data.signature],
          ['Date', data.signatureDate]
        ]);
        if (doc.getNumberOfPages() > 1 && y < 100) {
          doc.deletePage(1);
        }
        doc.save(`submission_${data.name}_${Date.now()}.pdf`);
        const json = JSON.stringify(data, null, 2);
        const jsonBlob = new Blob([json], { type: 'application/json' });
        const jsonUrl = URL.createObjectURL(jsonBlob);
        const jsonLink = document.createElement('a');
        jsonLink.href = jsonUrl;
        jsonLink.download = `submission_${data.name}_${Date.now()}.json`;
        jsonLink.click();
        URL.revokeObjectURL(jsonUrl);
        const csv = Object.entries(data).map(([key, value]) => `${key},${value}`).join('\n');
        const csvBlob = new Blob([csv], { type: 'text/csv' });
        const csvUrl = URL.createObjectURL(csvBlob);
        const csvLink = document.createElement('a');
        csvLink.href = csvUrl;
        csvLink.download = `${data.name}_submission.csv`;
        csvLink.click();
        URL.revokeObjectURL(csvUrl);
        let submissions = JSON.parse(localStorage.getItem('submissions') || '[]');
        submissions.push({ file: `submission_${data.name}_${Date.now()}.json`, ...data });
        localStorage.setItem('submissions', JSON.stringify(submissions));
        alert('Submission successful! PDF, JSON, and CSV downloaded. Upload PDF/CSV to Google Drive manually.');
      } catch (error) {
        console.error('Error processing submission:', error);
        alert('Error: ' + error.message);
      }
    });
  </script>
</body>
</html>
